<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Login - Sistem Kasir</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --success-color: #4ecdc4;
            --error-color: #ff6b6b;
            --warning-color: #feca57;
            --dark-bg: #1a1a2e;
            --card-bg: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --text-light: #ffffff;
            --text-dark: #2c3e50;
            --shadow-light: rgba(255, 255, 255, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 50%, var(--accent-color) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        /* Animated background elements */
        .bg-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .floating-shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite linear;
        }

        .floating-shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 10%;
            left: 20%;
            animation-delay: 0s;
        }

        .floating-shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 70%;
            left: 80%;
            animation-delay: -5s;
        }

        .floating-shape:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 40%;
            left: 10%;
            animation-delay: -10s;
        }

        .floating-shape:nth-child(4) {
            width: 100px;
            height: 100px;
            top: 20%;
            left: 80%;
            animation-delay: -15s;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0px) rotate(360deg); }
        }

        /* Main container with glassmorphism effect */
        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            width: 100%;
            max-width: 420px;
            padding: 40px;
            position: relative;
            color: var(--text-light);
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .container:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Header with logo and title */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--success-color), var(--primary-color));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.8;
            font-weight: 400;
        }

        /* Form styling */
        .form-group {
            position: relative;
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            opacity: 0.9;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 18px;
            z-index: 2;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-input:focus {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .password-toggle {
            position: absolute;
            right: 16px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 18px;
            z-index: 2;
            transition: color 0.3s ease;
        }

        .password-toggle:hover {
            color: var(--success-color);
        }

        /* Status indicators */
        .attempts-counter {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-align: right;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
        }

        .attempts-dots {
            display: flex;
            gap: 4px;
        }

        .attempt-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .attempt-dot.used {
            background: var(--error-color);
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .btn {
            flex: 1;
            padding: 16px 0;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--success-color), var(--primary-color));
            color: white;
            box-shadow: 0 4px 20px rgba(78, 205, 196, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(78, 205, 196, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Loading spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status messages */
        .status-message {
            padding: 16px;
            border-radius: 12px;
            margin-top: 20px;
            font-size: 14px;
            font-weight: 500;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-message.success {
            background: rgba(78, 205, 196, 0.2);
            color: var(--success-color);
            border-color: rgba(78, 205, 196, 0.3);
        }

        .status-message.error {
            background: rgba(255, 107, 107, 0.2);
            color: var(--error-color);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .status-message.warning {
            background: rgba(254, 202, 87, 0.2);
            color: var(--warning-color);
            border-color: rgba(254, 202, 87, 0.3);
        }

        /* Lock screen */
        .lock-screen {
            text-align: center;
            display: none;
        }

        .lock-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--error-color), var(--warning-color));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 32px;
            color: white;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3);
        }

        .lock-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .lock-description {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .countdown {
            font-size: 18px;
            font-weight: 600;
            color: var(--warning-color);
            margin-bottom: 24px;
            padding: 16px;
            background: rgba(254, 202, 87, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(254, 202, 87, 0.2);
        }

        .unlock-section {
            margin-top: 24px;
            display: none;
        }

        .unlock-input {
            margin-bottom: 16px;
        }

        /* Progress bar */
        .progress-container {
            margin-top: 24px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--primary-color));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            opacity: 0.7;
        }

        /* Responsive design */
        @media (max-width: 480px) {
            .container {
                padding: 24px;
                margin: 16px;
            }

            .title {
                font-size: 24px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            animation: slideIn 0.6s ease-out;
        }

        .form-group {
            animation: slideIn 0.6s ease-out;
        }

        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .btn-group { animation-delay: 0.4s; }

        /* Pulse animation for attention */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <!-- Animated background -->
    <div class="bg-animation">
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
    </div>

    <div class="container" id="login-container">
        <!-- Login Form -->
        <div id="login-form">
            <div class="header">
                <div class="logo">
                    <i class="fas fa-cash-register"></i>
                </div>
                <h1 class="title">Selamat Datang</h1>
                <p class="subtitle">Masuk ke sistem kasir FXID</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <div class="input-wrapper">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="username" class="form-input" placeholder="Masukkan username" required>
                    </div>
                    <div class="attempts-counter" id="attemptsCounter">
                        <span id="attemptsText"></span>
                        <div class="attempts-dots" id="attemptsDots"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="password" class="form-input" placeholder="Masukkan password" required>
                        <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="login()" id="loginBtn">
                        <span id="loginText">Masuk</span>
                        <div class="spinner" id="loginSpinner" style="display: none;"></div>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='akun.html'">
                        <i class="fas fa-user-plus"></i>
                        Daftar
                    </button>
                </div>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </form>

            <div class="status-message" id="statusMessage"></div>
        </div>

        <!-- Lock Screen -->
        <div class="lock-screen" id="lockScreen">
            <div class="lock-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2 class="lock-title">Akun Terkunci</h2>
            <p class="lock-description">
                Akun Anda telah terkunci sementara karena terlalu banyak percobaan masuk yang gagal. 
                Silakan tunggu atau gunakan kode unlock.
            </p>
            
            <div class="countdown" id="lockCountdown"></div>
            
            <button class="btn btn-primary" onclick="showUnlockPrompt()">
                <i class="fas fa-unlock"></i>
                Buka Kunci Akun
            </button>
            
            <div class="unlock-section" id="unlockSection">
                <div class="form-group">
                    <label for="unlockCode">Kode Unlock</label>
                    <div class="input-wrapper">
                        <i class="fas fa-key input-icon"></i>
                        <input type="text" id="unlockCode" class="form-input" placeholder="Masukkan kode unlock" required>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="unlockAccount()">
                    <i class="fas fa-unlock-alt"></i>
                    Unlock
                </button>
            </div>
            
            <div class="status-message" id="unlockStatusMessage"></div>
        </div>

        <div class="footer">
            <p>&copy; 2025 Sistem Kasir. Semua hak cipta dilindungi.</p>
        </div>
    </div>

    <script>
        let loginAttempts = JSON.parse(localStorage.getItem('loginAttempts')) || {};
        const MAX_ATTEMPTS = 5;
        const LOCK_DURATION = 5 * 60 * 1000; // 5 minutes
        let countdownInterval;

        // Initialize on page load
        window.addEventListener('load', function() {
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            usernameInput.focus();
            
            // Add event listeners
            usernameInput.addEventListener('input', updateAttemptsCounter);
            
            // Check for saved username
            const lastUsername = localStorage.getItem('lastUsername');
            if (lastUsername) {
                usernameInput.value = lastUsername;
                passwordInput.focus();
                updateAttemptsCounter();
            }

            // Setup password toggle
            setupPasswordToggle();
            
            // Setup form submission
            setupFormSubmission();
        });

        function setupPasswordToggle() {
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            
            togglePassword.addEventListener('click', function() {
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    this.classList.remove('fa-eye');
                    this.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    this.classList.remove('fa-eye-slash');
                    this.classList.add('fa-eye');
                }
            });
        }

        function setupFormSubmission() {
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    if (document.getElementById('login-form').style.display !== 'none') {
                        login();
                    } else if (document.getElementById('unlockSection').style.display !== 'none') {
                        unlockAccount();
                    }
                }
            });
        }

        function updateAttemptsCounter() {
            const username = document.getElementById('username').value;
            const attemptsCounter = document.getElementById('attemptsCounter');
            const attemptsText = document.getElementById('attemptsText');
            const attemptsDots = document.getElementById('attemptsDots');
            
            if (username && loginAttempts[username]) {
                const attempts = loginAttempts[username].attempts || 0;
                
                if (attempts > 0) {
                    attemptsText.textContent = `${attempts}/${MAX_ATTEMPTS} percobaan`;
                    
                    // Update dots
                    attemptsDots.innerHTML = '';
                    for (let i = 0; i < MAX_ATTEMPTS; i++) {
                        const dot = document.createElement('div');
                        dot.className = 'attempt-dot' + (i < attempts ? ' used' : '');
                        attemptsDots.appendChild(dot);
                    }
                    
                    attemptsCounter.style.display = 'flex';
                    
                    if (loginAttempts[username].locked) {
                        checkLockStatus(username);
                    }
                } else {
                    attemptsCounter.style.display = 'none';
                }
            } else {
                attemptsCounter.style.display = 'none';
            }
        }

        function checkLockStatus(username) {
            if (!loginAttempts[username] || !loginAttempts[username].locked) return;
            
            const lockTime = new Date(loginAttempts[username].lockTime || 0);
            const now = new Date();
            const timeDiff = now - lockTime;
            
            if (timeDiff >= LOCK_DURATION) {
                loginAttempts[username].locked = false;
                loginAttempts[username].attempts = 0;
                localStorage.setItem('loginAttempts', JSON.stringify(loginAttempts));
                return;
            }
            
            showLockScreen(username);
        }

        function showLockScreen(username) {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('lockScreen').style.display = 'block';
            startLockCountdown(username);
        }

        function startLockCountdown(username) {
            const lockCountdown = document.getElementById('lockCountdown');
            const lockTime = new Date(loginAttempts[username].lockTime || new Date());
            const unlockTime = new Date(lockTime.getTime() + LOCK_DURATION);
            
            clearInterval(countdownInterval);
            
            countdownInterval = setInterval(() => {
                const now = new Date();
                const timeDiff = unlockTime - now;
                
                if (timeDiff <= 0) {
                    clearInterval(countdownInterval);
                    loginAttempts[username].locked = false;
                    loginAttempts[username].attempts = 0;
                    localStorage.setItem('loginAttempts', JSON.stringify(loginAttempts));
                    
                    lockCountdown.textContent = 'Waktu kunci telah habis. Silakan login kembali.';
                    setTimeout(() => {
                        document.getElementById('login-form').style.display = 'block';
                        document.getElementById('lockScreen').style.display = 'none';
                        updateAttemptsCounter();
                    }, 2000);
                    return;
                }
                
                const minutes = Math.floor(timeDiff / 60000);
                const seconds = Math.floor((timeDiff % 60000) / 1000);
                lockCountdown.textContent = `Akun akan terbuka dalam: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function generateCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let code = '';
            for (let i = 0; i < 12; i++) {
                code += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return code;
        }

        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginText = document.getElementById('loginText');
            const loginSpinner = document.getElementById('loginSpinner');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            
            if (!username || !password) {
                showStatusMessage('error', 'Silakan masukkan username dan password.');
                return;
            }
            
            localStorage.setItem('lastUsername', username);
            
            if (loginAttempts[username] && loginAttempts[username].locked) {
                checkLockStatus(username);
                return;
            }
            
            // Show loading state
            loginText.style.display = 'none';
            loginSpinner.style.display = 'block';
            loginBtn.disabled = true;
            progressContainer.style.display = 'block';
            
            // Animate progress bar
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                progressFill.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 80);
            
            setTimeout(() => {
                let accounts = JSON.parse(localStorage.getItem('accounts')) || [];
                let user = accounts.find(account => account.username === username);
                
                if (!user) {
                    resetLoginUI();
                    showStatusMessage('error', 'Akun tidak ditemukan.');
                    incrementLoginAttempts(username);
                    return;
                }

                try {
                    const decryptedPassword = CryptoJS.AES.decrypt(user.password, 'secret key 123').toString(CryptoJS.enc.Utf8);
                    
                    if (decryptedPassword !== password) {
                        resetLoginUI();
                        showStatusMessage('error', 'Username atau password salah.');
                        incrementLoginAttempts(username);
                        return;
                    }
                    
                    // Success
                    resetLoginAttempts(username);
                    progressFill.style.width = '100%';
                    showStatusMessage('success', 'Login berhasil! Mengalihkan ke dashboard...');
                    
                    saveActivityLog(username, 'Login');
                    
                    localStorage.setItem('loggedIn', 'true');
                    localStorage.setItem('username', username);
                    
                    setTimeout(() => {
                        window.location.href = 'kasir.html';
                    }, 1500);
                } catch (error) {
                    resetLoginUI();
                    showStatusMessage('error', 'Terjadi kesalahan saat login. Silakan coba lagi.');
                    console.error('Login error:', error);
                }
            }, 800);
        }

        function resetLoginUI() {
            const loginText = document.getElementById('loginText');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginBtn = document.getElementById('loginBtn');
            const progressContainer = document.getElementById('progressContainer');
            
            loginText.style.display = 'block';
            loginSpinner.style.display = 'none';
            loginBtn.disabled = false;
            progressContainer.style.display = 'none';
        }

        function showStatusMessage(type, message) {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.className = 'status-message ' + type;
            statusMessage.style.display = 'block';
            
            if (type === 'error') {
                statusMessage.classList.add('pulse');
                setTimeout(() => {
                    statusMessage.classList.remove('pulse');
                    statusMessage.style.display = 'none';
                }, 5000);
            }
        }

        function incrementLoginAttempts(username) {
            if (!loginAttempts[username]) {
                loginAttempts[username] = { attempts: 0, locked: false };
            }

            loginAttempts[username].attempts += 1;

            if (loginAttempts[username].attempts >= MAX_ATTEMPTS) {
                loginAttempts[username].locked = true;
                loginAttempts[username].lockTime = new Date().toISOString();
                loginAttempts[username].unlockCode = generateCode();
                
                saveActivityLog(username, 'Account Locked');
                showLockScreen(username);
                showStatusMessage('warning', 'Akun terkunci karena terlalu banyak percobaan login yang gagal.');
            }

            localStorage.setItem('loginAttempts', JSON.stringify(loginAttempts));
            updateAttemptsCounter();
        }

        function resetLoginAttempts(username) {
            if (loginAttempts[username]) {
                loginAttempts[username].attempts = 0;
                loginAttempts[username].locked = false;
                localStorage.setItem('loginAttempts', JSON.stringify(loginAttempts));
                updateAttemptsCounter();
            }
        }

        function showUnlockPrompt() {
            const username = document.getElementById('username').value;
            const unlockStatusMessage = document.getElementById('unlockStatusMessage');
            
            if (!username || !loginAttempts[username] || !loginAttempts[username].locked) {
                unlockStatusMessage.textContent = 'Harap masukkan username terlebih dahulu.';
                unlockStatusMessage.className = 'status-message error';
                unlockStatusMessage.style.display = 'block';
                return;
            }
            
            const pin = prompt('Masukkan PIN untuk mendapatkan kode unlock:');

            if (pin === '451') {
                let unlockCode = loginAttempts[username].unlockCode;
                
                navigator.clipboard.writeText(unlockCode).then(function() {
                    unlockStatusMessage.textContent = 'Kode unlock telah disalin ke clipboard.';
                    unlockStatusMessage.className = 'status-message success';
                    unlockStatusMessage.style.display = 'block';
                }, function() {
                    unlockStatusMessage.textContent = `Kode unlock Anda adalah: ${unlockCode}`;
                    unlockStatusMessage.className = 'status-message success';
                    unlockStatusMessage.style.display = 'block';
                });
                
                document.getElementById('unlockSection').style.display = 'block';
                document.getElementById('unlockCode').focus();
            } else {
                unlockStatusMessage.textContent = 'PIN salah. Silakan coba lagi.';
                unlockStatusMessage.className = 'status-message error';
                unlockStatusMessage.style.display = 'block';
            }
        }

        function unlockAccount() {
            const username = document.getElementById('username').value;
            const unlockCode = document.getElementById('unlockCode').value;
            const unlockStatusMessage = document.getElementById('unlockStatusMessage');

            if (!username || !loginAttempts[username]) {
                unlockStatusMessage.textContent = 'Akun tidak ditemukan.';
                unlockStatusMessage.className = 'status-message error';
                unlockStatusMessage.style.display = 'block';
                return;
            }

            if (unlockCode === loginAttempts[username].unlockCode) {
                loginAttempts[username].attempts = 0;
                loginAttempts[username].locked = false;
                loginAttempts[username].unlockCode = generateCode();
                
                localStorage.setItem('loginAttempts', JSON.stringify(loginAttempts));
                
                unlockStatusMessage.textContent = 'Akun berhasil dibuka! Mengalihkan ke halaman login...';
                unlockStatusMessage.className = 'status-message success';
                unlockStatusMessage.style.display = 'block';
                
                saveActivityLog(username, 'Account Unlocked');
                
                setTimeout(() => {
                    document.getElementById('login-form').style.display = 'block';
                    document.getElementById('lockScreen').style.display = 'none';
                    document.getElementById('unlockSection').style.display = 'none';
                    document.getElementById('unlockCode').value = '';
                    updateAttemptsCounter();
                    clearInterval(countdownInterval);
                }, 2000);
                
            } else {
                unlockStatusMessage.textContent = 'Kode unlock salah. Silakan coba lagi.';
                unlockStatusMessage.className = 'status-message error';
                unlockStatusMessage.style.display = 'block';
                
                // Add shake animation to unlock input
                const unlockInput = document.getElementById('unlockCode');
                unlockInput.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    unlockInput.style.animation = '';
                }, 500);
            }
        }

        function saveActivityLog(username, action) {
            let activityLog = JSON.parse(localStorage.getItem('activityLog')) || [];
            
            activityLog.push({
                username: username,
                action: action,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                ip: '127.0.0.1'
            });
            
            if (activityLog.length > 100) {
                activityLog = activityLog.slice(-100);
            }
            
            localStorage.setItem('activityLog', JSON.stringify(activityLog));
        }

        // Add shake animation for error feedback
        const shakeKeyframes = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        
        const styleElement = document.createElement('style');
        styleElement.textContent = shakeKeyframes;
        document.head.appendChild(styleElement);

        // Add ripple effect to buttons
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn')) {
                const button = e.target;
                const ripple = document.createElement('span');
                const rect = button.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple 0.6s ease-out;
                    pointer-events: none;
                `;
                
                button.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            }
        });

        // Add ripple animation
        const rippleKeyframes = `
            @keyframes ripple {
                to {
                    transform: scale(2);
                    opacity: 0;
                }
            }
        `;
        
        const rippleStyleElement = document.createElement('style');
        rippleStyleElement.textContent = rippleKeyframes;
        document.head.appendChild(rippleStyleElement);

        // Add typing effect for placeholder text
        function typeWriter(element, text, speed = 100) {
            let i = 0;
            element.placeholder = '';
            
            function type() {
                if (i < text.length) {
                    element.placeholder += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                }
            }
            
            type();
        }

        // Add particle effect on successful login
        function createParticles() {
            const particleContainer = document.createElement('div');
            particleContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 9999;
            `;
            
            document.body.appendChild(particleContainer);
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute;
                    width: 6px;
                    height: 6px;
                    background: ${['#4ecdc4', '#667eea', '#f093fb'][Math.floor(Math.random() * 3)]};
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: particle-float 3s ease-out forwards;
                `;
                
                particleContainer.appendChild(particle);
            }
            
            setTimeout(() => {
                particleContainer.remove();
            }, 3000);
        }

        // Add particle animation
        const particleKeyframes = `
            @keyframes particle-float {
                0% {
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
                100% {
                    transform: translateY(-100px) scale(0);
                    opacity: 0;
                }
            }
        `;
        
        const particleStyleElement = document.createElement('style');
        particleStyleElement.textContent = particleKeyframes;
        document.head.appendChild(particleStyleElement);

        // Enhanced form validation with real-time feedback
        function setupFormValidation() {
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            usernameInput.addEventListener('input', function() {
                validateField(this, this.value.length >= 3);
            });
            
            passwordInput.addEventListener('input', function() {
                validateField(this, this.value.length >= 6);
            });
        }

        function validateField(field, isValid) {
            if (isValid) {
                field.style.borderColor = 'var(--success-color)';
                field.style.boxShadow = '0 0 0 3px rgba(78, 205, 196, 0.2)';
            } else {
                field.style.borderColor = 'var(--error-color)';
                field.style.boxShadow = '0 0 0 3px rgba(255, 107, 107, 0.2)';
            }
        }

        // Initialize enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            setupFormValidation();
            
            // Add smooth transitions to all elements
            const elements = document.querySelectorAll('*');
            elements.forEach(el => {
                el.style.transition = 'all 0.3s ease';
            });
        });
    </script>
</body>
</html>