<!DOCTYPE html>
<html lang="id">
<head>
  
    <title>Pembuat Label Price Tag</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6da7;
            --secondary-color: #f8f9fa;
            --accent-color: #ff6b6b;
            --text-color: #333;
            --border-color: #dee2e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-container input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button:hover {
            background-color: #3a5b8c;
        }

        .products-container {
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        thead {
            background-color: var(--primary-color);
            color: white;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        tbody tr:hover {
            background-color: var(--secondary-color);
        }

        .selected-row {
            background-color: #e6f7ff !important;
        }

        .checkbox-cell {
            text-align: center;
        }

        .price-tags-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .price-tag {
            border: 2px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            width: 250px;
            height: 150px;
            page-break-inside: avoid;
        }

        .price-tag-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 5px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .price-tag-title {
            font-weight: bold;
            font-size: 18px;
            margin: 5px 0;
            text-align: center;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .price-tag-price {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin-top: 10px;
        }

        .price-tag-footer {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-top: 10px;
            border-top: 1px dashed var(--border-color);
            padding-top: 5px;
        }

        .print-section {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .price-tags-print-container, .price-tags-print-container * {
                visibility: visible;
            }
            .price-tags-print-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .container {
                box-shadow: none;
                border: none;
            }
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
        }

        .tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            margin-bottom: -2px;
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        .layout-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .layout-option {
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s;
        }

        .layout-option.active {
            border-color: var(--primary-color);
            background-color: rgba(74, 109, 167, 0.1);
        }

        .layout-option-image {
            width: 80px;
            height: 60px;
            background-color: #eee;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .layout-settings {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-color);
            border-radius: 4px;
        }

        .settings-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .setting-item {
            flex: 1;
            min-width: 200px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .setting-item input, .setting-item select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #4CAF50;
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s, fadeOut 0.5s 2.5s;
            animation-fill-mode: forwards;
        }

        @keyframes slideIn {
            from {
                right: -300px;
                opacity: 0;
            }
            to {
                right: 20px;
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
                visibility: hidden;
            }
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 30px;
            color: #888;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pembuat Label Price Tag</h1>

        <div class="tab-container">
            <div class="tabs">
                <button class="tab active" data-tab="browse">Pilih Produk</button>
                <button class="tab" data-tab="preview">Preview Label</button>
                <button class="tab" data-tab="settings">Pengaturan</button>
            </div>

            <div id="browse" class="tab-content active">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Cari nama barang atau kode...">
                    <button id="searchButton"><i class="fas fa-search"></i> Cari</button>
                </div>

                <div class="products-container">
                    <table id="productsTable">
                        <thead>
                            <tr>
                                <th class="checkbox-cell"><input type="checkbox" id="selectAll"></th>
                                <th>Kode Toko</th>
                                <th>Kode Barang</th>
                                <th>PLU</th>
                                <th>Nama Barang</th>
                                <th>Kategori</th>
                                <th>Harga</th>
                                <th>Stok</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody"></tbody>
                    </table>
                    <div id="noDataMessage" class="no-data" style="display: none;">
                        Tidak ada data produk yang tersedia. Silakan tambahkan produk terlebih dahulu.
                    </div>
                </div>

                <button id="generateButton"><i class="fas fa-tags"></i> Buat Label</button>
            </div>

            <div id="preview" class="tab-content">
                <div class="layout-options">
                    <div class="layout-option active" data-layout="standard">
                        <div class="layout-option-image">
                            <i class="fas fa-tag fa-2x"></i>
                        </div>
                        <span>Standar</span>
                    </div>
                    <div class="layout-option" data-layout="compact">
                        <div class="layout-option-image">
                            <i class="fas fa-ticket-alt fa-2x"></i>
                        </div>
                        <span>Kompak</span>
                    </div>
                    <div class="layout-option" data-layout="detailed">
                        <div class="layout-option-image">
                            <i class="fas fa-receipt fa-2x"></i>
                        </div>
                        <span>Detail</span>
                    </div>
                </div>

                <div class="print-section">
                    <button id="printButton"><i class="fas fa-print"></i> Cetak</button>
                    <button id="downloadPdfButton"><i class="fas fa-file-pdf"></i> Download PDF</button>
                </div>

                <div id="priceTagsContainer" class="price-tags-container price-tags-print-container">
                    <!-- Price tags will be generated here -->
                </div>
            </div>

            <div id="settings" class="tab-content">
                <h2>Pengaturan Label</h2>
                <div class="layout-settings">
                    <div class="settings-row">
                        <div class="setting-item">
                            <label for="priceTagWidth">Lebar Label (mm)
                                <span class="tooltip"><i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Lebar label price tag dalam satuan milimeter</span>
                                </span>
                            </label>
                            <input type="number" id="priceTagWidth" value="60" min="30" max="200">
                        </div>
                        <div class="setting-item">
                            <label for="priceTagHeight">Tinggi Label (mm)
                                <span class="tooltip"><i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Tinggi label price tag dalam satuan milimeter</span>
                                </span>
                            </label>
                            <input type="number" id="priceTagHeight" value="40" min="20" max="150">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="setting-item">
                            <label for="fontSize">Ukuran Font Harga
                                <span class="tooltip"><i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Ukuran font untuk tampilan harga pada label</span>
                                </span>
                            </label>
                            <input type="number" id="fontSize" value="18" min="12" max="36">
                        </div>
                        <div class="setting-item">
                            <label for="labelsPerPage">Label per Halaman
                                <span class="tooltip"><i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Jumlah label yang akan dicetak dalam satu halaman</span>
                                </span>
                            </label>
                            <input type="number" id="labelsPerPage" value="12" min="1" max="50">
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="setting-item">
                            <label for="borderType">Jenis Border
                                <span class="tooltip"><i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Jenis garis tepi pada label price tag</span>
                                </span>
                            </label>
                            <select id="borderType">
                                <option value="solid">Solid</option>
                                <option value="dashed">Dashed</option>
                                <option value="dotted">Dotted</option>
                                <option value="none">Tanpa Border</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="paperSize">Ukuran Kertas
                                <span class="tooltip"><i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Ukuran kertas yang digunakan untuk mencetak label</span>
                                </span>
                            </label>
                            <select id="paperSize">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                    </div>
                    <button id="saveSettingsButton"><i class="fas fa-save"></i> Simpan Pengaturan</button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        Pengaturan berhasil disimpan!
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <script>
  document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const productsTableBody = document.getElementById('productsTableBody');
    const selectAllCheckbox = document.getElementById('selectAll');
    const generateButton = document.getElementById('generateButton');
    const priceTagsContainer = document.getElementById('priceTagsContainer');
    const printButton = document.getElementById('printButton');
    const downloadPdfButton = document.getElementById('downloadPdfButton');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const layoutOptions = document.querySelectorAll('.layout-option');
    const saveSettingsButton = document.getElementById('saveSettingsButton');
    const notification = document.getElementById('notification');
    const loading = document.getElementById('loading');
    const noDataMessage = document.getElementById('noDataMessage');

    // Settings
    let settings = {
        priceTagWidth: 60,
        priceTagHeight: 40,
        fontSize: 18,
        labelsPerPage: 12,
        borderType: 'solid',
        paperSize: 'a4',
        layout: 'standard'
    };

    // Load settings from localStorage
    const savedSettings = localStorage.getItem('priceTagSettings');
    if (savedSettings) {
        settings = JSON.parse(savedSettings);
        
        // Apply saved settings to form
        document.getElementById('priceTagWidth').value = settings.priceTagWidth;
        document.getElementById('priceTagHeight').value = settings.priceTagHeight;
        document.getElementById('fontSize').value = settings.fontSize;
        document.getElementById('labelsPerPage').value = settings.labelsPerPage;
        document.getElementById('borderType').value = settings.borderType;
        document.getElementById('paperSize').value = settings.paperSize;
        
        // Apply saved layout option
        layoutOptions.forEach(option => {
            if (option.dataset.layout === settings.layout) {
                option.classList.add('active');
            } else {
                option.classList.remove('active');
            }
        });
    }

    // Selected products for price tag generation
    let selectedProducts = [];

    // Load products from localStorage
    function loadProducts() {
        const barang = JSON.parse(localStorage.getItem('barang')) || [];
        
        if (barang.length === 0) {
            noDataMessage.style.display = 'block';
            document.getElementById('productsTable').style.display = 'none';
        } else {
            noDataMessage.style.display = 'none';
            document.getElementById('productsTable').style.display = 'table';
            displayProducts(barang);
        }
    }

    // Display products in the table
    function displayProducts(products) {
        productsTableBody.innerHTML = '';
        
        products.forEach(product => {
            const row = document.createElement('tr');
            
            // Checkbox cell
            const checkboxCell = document.createElement('td');
            checkboxCell.className = 'checkbox-cell';
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.dataset.kode = product.kode;
            checkbox.addEventListener('change', toggleProductSelection);
            checkboxCell.appendChild(checkbox);
            
            // Create data cells
            const cells = [
                checkboxCell,
                createCell(product.kodeToko || '-'),
                createCell(product.kode || '-'),
                createCell(product.plu || '-'),
                createCell(product.nama || '-'),
                createCell(product.kategori || '-'),
                createCell(formatRupiah(product.hargaJual) || '-'),
                createCell(product.stok || '0')
            ];
            
            // Add cells to row
            cells.forEach(cell => row.appendChild(cell));
            
            // Add row to table body
            productsTableBody.appendChild(row);
        });
    }

    // Helper function to create a table cell
    function createCell(text) {
        const cell = document.createElement('td');
        cell.textContent = text;
        return cell;
    }

    // Format Rupiah
    function formatRupiah(amount) {
        if (!amount) return 'Rp 0';
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        }).format(amount);
    }

    // Toggle product selection
    function toggleProductSelection(e) {
        const kode = e.target.dataset.kode;
        const isChecked = e.target.checked;
        
        const barang = JSON.parse(localStorage.getItem('barang')) || [];
        const product = barang.find(item => item.kode === kode);
        
        if (isChecked && product) {
            selectedProducts.push(product);
        } else {
            selectedProducts = selectedProducts.filter(item => item.kode !== kode);
        }
        
        // Highlight selected rows
        const row = e.target.closest('tr');
        if (isChecked) {
            row.classList.add('selected-row');
        } else {
            row.classList.remove('selected-row');
        }
        
        // Update "Select All" checkbox state
        updateSelectAllCheckbox();
    }

    // Update "Select All" checkbox state
    function updateSelectAllCheckbox() {
        const checkboxes = productsTableBody.querySelectorAll('input[type="checkbox"]');
        const checkedCount = productsTableBody.querySelectorAll('input[type="checkbox"]:checked').length;
        
        selectAllCheckbox.checked = checkboxes.length > 0 && checkedCount === checkboxes.length;
        selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
    }

    // Handle "Select All" checkbox
    selectAllCheckbox.addEventListener('change', function() {
        const checkboxes = productsTableBody.querySelectorAll('input[type="checkbox"]');
        const isChecked = this.checked;
        
        checkboxes.forEach(checkbox => {
            checkbox.checked = isChecked;
            
            // Trigger change event to update selectedProducts array
            const event = new Event('change');
            checkbox.dispatchEvent(event);
        });
    });

    // Search products
    searchButton.addEventListener('click', searchProducts);
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchProducts();
        }
    });

    function searchProducts() {
        const searchText = searchInput.value.toLowerCase();
        const barang = JSON.parse(localStorage.getItem('barang')) || [];
        
        if (searchText.trim() === '') {
            displayProducts(barang);
        } else {
            const filteredProducts = barang.filter(product => 
                (product.nama && product.nama.toLowerCase().includes(searchText)) ||
                (product.kode && product.kode.toLowerCase().includes(searchText)) ||
                (product.plu && product.plu.toLowerCase().includes(searchText)) ||
                (product.kodeToko && product.kodeToko.toLowerCase().includes(searchText))
            );
            
            displayProducts(filteredProducts);
        }
    }

    // Generate price tags
    generateButton.addEventListener('click', function() {
        if (selectedProducts.length === 0) {
            alert('Silakan pilih minimal satu produk untuk membuat label price tag.');
            return;
        }
        
        generatePriceTags();
        
        // Switch to preview tab
        switchTab(document.querySelector('.tab[data-tab="preview"]'));
    });

    // Generate price tags based on selected products and settings
    
    // Generate price tags based on selected products and settings
function generatePriceTags() {
    priceTagsContainer.innerHTML = '';
    
    // Apply settings to container with improved sizing calculation
    const pxWidth = Math.round(settings.priceTagWidth * 3.78); // Convert mm to px (96dpi)
    const pxHeight = Math.round(settings.priceTagHeight * 3.78); // Convert mm to px (96dpi)
    
    // Improve grid layout with better spacing
    priceTagsContainer.style.gridTemplateColumns = `repeat(auto-fill, minmax(${pxWidth}px, 1fr))`;
    priceTagsContainer.style.gap = '15px';
    
    selectedProducts.forEach(product => {
        const priceTag = document.createElement('div');
        priceTag.className = 'price-tag';
        priceTag.style.width = `${pxWidth}px`;
        priceTag.style.height = `${pxHeight}px`;
        priceTag.style.padding = '10px';
        priceTag.style.boxSizing = 'border-box';
        priceTag.style.display = 'flex';
        priceTag.style.flexDirection = 'column';
        priceTag.style.justifyContent = 'space-between';
        priceTag.style.backgroundColor = '#ffffff';
        priceTag.style.borderRadius = '8px';
        priceTag.style.overflow = 'hidden';
        
        // Add nice visuals depending on border type
        if (settings.borderType === 'none') {
            priceTag.style.boxShadow = '0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)';
        } else {
            priceTag.style.border = `2px ${settings.borderType} var(--border-color)`;
        }
        
        let priceTagContent = '';
        
        // Enhanced layouts with better design and responsiveness
        switch(settings.layout) {
            case 'compact':
                priceTagContent = `
                    <div class="price-tag-header" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #555; background-color: #f8f9fa; padding: 5px; margin: -10px -10px 8px -10px; border-bottom: 1px solid #e9ecef;">
                        <span>${product.kodeToko || '-'}</span>
                        <span>${product.kode || '-'}</span>
                    </div>
                    <div class="price-tag-title" style="font-size: ${Math.max(10, settings.fontSize - 7)}px; font-weight: bold; margin: 3px 0; text-align: center; word-wrap: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${product.nama || '-'}</div>
                    <div class="price-tag-price" style="font-size: ${settings.fontSize}px; font-weight: bold; text-align: center; color: #e63946; background-color: #f8f9fa; padding: 5px; margin: 8px -10px -10px -10px; border-top: 1px solid #e9ecef;">${formatRupiah(product.hargaJual)}</div>
                `;
                break;
                
            case 'detailed':
                priceTagContent = `
                    <div class="price-tag-header" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #555; background-color: #f8f9fa; padding: 5px; margin: -10px -10px 8px -10px; border-bottom: 1px solid #e9ecef;">
                        <span style="font-weight: 500;">Toko: ${product.kodeToko || '-'}</span>
                        <span style="font-weight: 500;">Kode: ${product.kode || '-'}</span>
                    </div>
                    <div class="price-tag-title" style="font-size: ${Math.max(10, settings.fontSize - 7)}px; font-weight: bold; margin: 3px 0; text-align: center; word-wrap: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${product.nama || '-'}</div>
                    <div class="price-tag-price" style="font-size: ${settings.fontSize}px; font-weight: bold; text-align: center; color: #e63946; margin: 5px 0; padding: 5px; border-radius: 4px; background-color: #fff5f5;">${formatRupiah(product.hargaJual)}</div>
                    <div class="price-tag-footer" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #555; margin-top: 5px; background-color: #f8f9fa; padding: 5px; margin: 8px -10px -10px -10px; border-top: 1px solid #e9ecef;">
                        <span style="font-weight: 500;">Kat: ${product.kategori || '-'}</span>
                        <span style="font-weight: 500;">PLU: ${product.plu || '-'}</span>
                    </div>
                `;
                break;
                
            default: // Modern standard layout
                priceTagContent = `
                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, var(--primary-color), #8da9cf);"></div>
                    <div class="price-tag-header" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #6c757d; padding: 2px 0; margin-top: 3px;">
                        <span style="font-weight: 500;">${product.kodeToko || '-'}</span>
                        <span style="font-weight: 500;">${product.kode || '-'}</span>
                    </div>
                    <div class="price-tag-title" style="font-size: ${Math.max(10, settings.fontSize - 7)}px; font-weight: bold; margin: 10px 0; text-align: center; word-wrap: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: #495057;">${product.nama || '-'}</div>
                    <div class="price-tag-price" style="font-size: ${settings.fontSize}px; font-weight: bold; text-align: center; color: #e63946; background-color: #f8f9fa; padding: 8px 5px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 5px;">${formatRupiah(product.hargaJual)}</div>
                    <div class="price-tag-footer" style="display: flex; justify-content: center; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #6c757d; margin-top: auto; padding-top: 5px; border-top: 1px dashed #e9ecef;">
                        <span style="font-weight: 500;">PLU: ${product.plu || '-'}</span>
                    </div>
                `;
        }
        
        priceTag.innerHTML = priceTagContent;
        priceTagsContainer.appendChild(priceTag);
    });
    
    // Add print-friendly styles
    const styleElement = document.getElementById('print-styles') || document.createElement('style');
    if (!document.getElementById('print-styles')) {
        styleElement.id = 'print-styles';
        document.head.appendChild(styleElement);
    }
    
    styleElement.textContent = `
        @media print {
            body * {
                visibility: hidden;
            }
            #priceTagsContainer, #priceTagsContainer * {
                visibility: visible;
            }
            #priceTagsContainer {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(${settings.priceTagWidth * 3.78}px, 1fr));
                gap: 5mm;
                padding: 5mm;
            }
            .price-tag {
                break-inside: avoid;
                page-break-inside: avoid;
                box-shadow: none !important;
                border: ${settings.borderType === 'none' ? '1px dashed #ccc' : `2px ${settings.borderType} var(--border-color)`};
            }
        }
    `;
}

// Generate batch labels function with improved design
function generateBatchLabels(count) {
    if (selectedProducts.length === 0) {
        alert('Silakan pilih minimal satu produk untuk membuat label batch.');
        return;
    }
    
    // Clear existing price tags
    priceTagsContainer.innerHTML = '';
    
    // Apply settings to container
    const pxWidth = Math.round(settings.priceTagWidth * 3.78);
    const pxHeight = Math.round(settings.priceTagHeight * 3.78);
    
    priceTagsContainer.style.gridTemplateColumns = `repeat(auto-fill, minmax(${pxWidth}px, 1fr))`;
    priceTagsContainer.style.gap = '15px';
    
    // Generate multiple labels for each product based on count
    selectedProducts.forEach(product => {
        for (let i = 0; i < count; i++) {
            const priceTag = document.createElement('div');
            priceTag.className = 'price-tag';
            priceTag.style.width = `${pxWidth}px`;
            priceTag.style.height = `${pxHeight}px`;
            priceTag.style.padding = '10px';
            priceTag.style.boxSizing = 'border-box';
            priceTag.style.display = 'flex';
            priceTag.style.flexDirection = 'column';
            priceTag.style.justifyContent = 'space-between';
            priceTag.style.backgroundColor = '#ffffff';
            priceTag.style.borderRadius = '8px';
            priceTag.style.overflow = 'hidden';
            
            // Add nice visuals depending on border type
            if (settings.borderType === 'none') {
                priceTag.style.boxShadow = '0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)';
            } else {
                priceTag.style.border = `2px ${settings.borderType} var(--border-color)`;
            }
            
            let priceTagContent = '';
            
            // Use same layout logic as in generatePriceTags
            switch(settings.layout) {
                case 'compact':
                    priceTagContent = `
                        <div class="price-tag-header" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #555; background-color: #f8f9fa; padding: 5px; margin: -10px -10px 8px -10px; border-bottom: 1px solid #e9ecef;">
                            <span>${product.kodeToko || '-'}</span>
                            <span>${product.kode || '-'}</span>
                        </div>
                        <div class="price-tag-title" style="font-size: ${Math.max(10, settings.fontSize - 7)}px; font-weight: bold; margin: 3px 0; text-align: center; word-wrap: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${product.nama || '-'}</div>
                        <div class="price-tag-price" style="font-size: ${settings.fontSize}px; font-weight: bold; text-align: center; color: #e63946; background-color: #f8f9fa; padding: 5px; margin: 8px -10px -10px -10px; border-top: 1px solid #e9ecef;">${formatRupiah(product.hargaJual)}</div>
                    `;
                    break;
                    
                case 'detailed':
                    priceTagContent = `
                        <div class="price-tag-header" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #555; background-color: #f8f9fa; padding: 5px; margin: -10px -10px 8px -10px; border-bottom: 1px solid #e9ecef;">
                            <span style="font-weight: 500;">Toko: ${product.kodeToko || '-'}</span>
                            <span style="font-weight: 500;">Kode: ${product.kode || '-'}</span>
                        </div>
                        <div class="price-tag-title" style="font-size: ${Math.max(10, settings.fontSize - 7)}px; font-weight: bold; margin: 3px 0; text-align: center; word-wrap: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${product.nama || '-'}</div>
                        <div class="price-tag-price" style="font-size: ${settings.fontSize}px; font-weight: bold; text-align: center; color: #e63946; margin: 5px 0; padding: 5px; border-radius: 4px; background-color: #fff5f5;">${formatRupiah(product.hargaJual)}</div>
                        <div class="price-tag-footer" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #555; margin-top: 5px; background-color: #f8f9fa; padding: 5px; margin: 8px -10px -10px -10px; border-top: 1px solid #e9ecef;">
                            <span style="font-weight: 500;">Kat: ${product.kategori || '-'}</span>
                            <span style="font-weight: 500;">PLU: ${product.plu || '-'}</span>
                        </div>
                    `;
                    break;
                    
                default: // Modern standard layout
                    priceTagContent = `
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, var(--primary-color), #8da9cf);"></div>
                        <div class="price-tag-header" style="display: flex; justify-content: space-between; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #6c757d; padding: 2px 0; margin-top: 3px;">
                            <span style="font-weight: 500;">${product.kodeToko || '-'}</span>
                            <span style="font-weight: 500;">${product.kode || '-'}</span>
                        </div>
                        <div class="price-tag-title" style="font-size: ${Math.max(10, settings.fontSize - 7)}px; font-weight: bold; margin: 10px 0; text-align: center; word-wrap: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: #495057;">${product.nama || '-'}</div>
                        <div class="price-tag-price" style="font-size: ${settings.fontSize}px; font-weight: bold; text-align: center; color: #e63946; background-color: #f8f9fa; padding: 8px 5px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 5px;">${formatRupiah(product.hargaJual)}</div>
                        <div class="price-tag-footer" style="display: flex; justify-content: center; font-size: ${Math.max(8, settings.fontSize - 10)}px; color: #6c757d; margin-top: auto; padding-top: 5px; border-top: 1px dashed #e9ecef;">
                            <span style="font-weight: 500;">PLU: ${product.plu || '-'}</span>
                        </div>
                    `;
            }
            
            priceTag.innerHTML = priceTagContent;
            priceTagsContainer.appendChild(priceTag);
        }
    });
}

// Function to add new layout options
function addNewLayoutOptions() {
    const layoutOptionsContainer = document.querySelector('.layout-options');
    if (!layoutOptionsContainer) return;
    
    // Clear existing layout options
    layoutOptionsContainer.innerHTML = '';
    
    // Define new layout options
    const layouts = [
        { id: 'standard', icon: 'fa-tag', name: 'Standar' },
        { id: 'compact', icon: 'fa-ticket-alt', name: 'Kompak' },
        { id: 'detailed', icon: 'fa-receipt', name: 'Detail' },
        { id: 'modern', icon: 'fa-star', name: 'Modern' },
        { id: 'elegant', icon: 'fa-gem', name: 'Elegant' }
    ];
    
    // Add new layout options to container
    layouts.forEach(layout => {
        const option = document.createElement('div');
        option.className = `layout-option ${layout.id === settings.layout ? 'active' : ''}`;
        option.dataset.layout = layout.id;
        option.innerHTML = `
            <div class="layout-option-image">
                <i class="fas ${layout.icon} fa-2x"></i>
            </div>
            <span>${layout.name}</span>
        `;
        
        // Add click event to toggle layout
        option.addEventListener('click', function() {
            // Remove active class from all options
            document.querySelectorAll('.layout-option').forEach(opt => opt.classList.remove('active'));
            
            // Add active class to clicked option
            this.classList.add('active');
            
            // Update settings
            settings.layout = this.dataset.layout;
            
            // Regenerate price tags with new layout
            generatePriceTags();
        });
        
        layoutOptionsContainer.appendChild(option);
    });
}

// Function to initialize new price tag styles and color schemes
function initPriceTagStyles() {
    // Add new color scheme options to settings
    const layoutSettings = document.querySelector('.layout-settings');
    if (!layoutSettings) return;
    
    // Create color scheme selection
    const colorSchemeRow = document.createElement('div');
    colorSchemeRow.className = 'settings-row';
    colorSchemeRow.innerHTML = `
        <div class="setting-item">
            <label for="colorScheme">Skema Warna
                <span class="tooltip"><i class="fas fa-info-circle"></i>
                    <span class="tooltiptext">Pilih skema warna untuk price tag</span>
                </span>
            </label>
            <select id="colorScheme">
                <option value="blue">Biru (Default)</option>
                <option value="green">Hijau</option>
                <option value="red">Merah</option>
                <option value="purple">Ungu</option>
                <option value="teal">Teal</option>
            </select>
        </div>
        <div class="setting-item">
            <label for="tagStyle">Gaya Label
                <span class="tooltip"><i class="fas fa-info-circle"></i>
                    <span class="tooltiptext">Pilih gaya tampilan untuk price tag</span>
                </span>
            </label>
            <select id="tagStyle">
                <option value="classic">Classic</option>
                <option value="modern">Modern</option>
                <option value="minimalist">Minimalist</option>
                <option value="bordered">Bordered</option>
                <option value="shadow">Shadow</option>
            </select>
        </div>
    `;
    
    // Add to layout settings before the save button
    const saveButton = document.getElementById('saveSettingsButton');
    if (saveButton) {
        layoutSettings.insertBefore(colorSchemeRow, saveButton.parentNode);
    } else {
        layoutSettings.appendChild(colorSchemeRow);
    }
    
    // Update saved settings to include new options
    if (!settings.colorScheme) settings.colorScheme = 'blue';
    if (!settings.tagStyle) settings.tagStyle = 'classic';
    
    // Populate selects with saved values if available
    const colorSchemeSelect = document.getElementById('colorScheme');
    const tagStyleSelect = document.getElementById('tagStyle');
    if (colorSchemeSelect) colorSchemeSelect.value = settings.colorScheme;
    if (tagStyleSelect) tagStyleSelect.value = settings.tagStyle;
    
    // Update save settings function to include new options
    const originalSaveSettingsButton = saveSettingsButton.cloneNode(true);
    saveSettingsButton.parentNode.replaceChild(originalSaveSettingsButton, saveSettingsButton);
    originalSaveSettingsButton.addEventListener('click', function() {
        // Get values from form (original logic)
        settings.priceTagWidth = parseInt(document.getElementById('priceTagWidth').value) || 60;
        settings.priceTagHeight = parseInt(document.getElementById('priceTagHeight').value) || 40;
        settings.fontSize = parseInt(document.getElementById('fontSize').value) || 18;
        settings.labelsPerPage = parseInt(document.getElementById('labelsPerPage').value) || 12;
        settings.borderType = document.getElementById('borderType').value;
        settings.paperSize = document.getElementById('paperSize').value;
        
        // Add new settings
        settings.colorScheme = document.getElementById('colorScheme').value;
        settings.tagStyle = document.getElementById('tagStyle').value;
        
        // Save to localStorage
        localStorage.setItem('priceTagSettings', JSON.stringify(settings));
        
        // Regenerate price tags with new settings if any exist
        if (selectedProducts.length > 0) {
            generatePriceTags();
        }
        
        // Show notification
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    });
}
  

    // Print price tags
    printButton.addEventListener('click', function() {
        window.print();
    });

    // Switch between tabs
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            switchTab(this);
        });
    });

    function switchTab(tab) {
        // Remove active class from all tabs and contents
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding content
        tab.classList.add('active');
        const tabId = tab.dataset.tab;
        document.getElementById(tabId).classList.add('active');
    }

    // Toggle between layout options
    layoutOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove active class from all options
            layoutOptions.forEach(opt => opt.classList.remove('active'));
            
            // Add active class to clicked option
            this.classList.add('active');
            
            // Update settings
            settings.layout = this.dataset.layout;
            
            // Regenerate price tags with new layout
            generatePriceTags();
        });
    });

    // Save settings
    saveSettingsButton.addEventListener('click', function() {
        // Get values from form
        settings.priceTagWidth = parseInt(document.getElementById('priceTagWidth').value) || 60;
        settings.priceTagHeight = parseInt(document.getElementById('priceTagHeight').value) || 40;
        settings.fontSize = parseInt(document.getElementById('fontSize').value) || 18;
        settings.labelsPerPage = parseInt(document.getElementById('labelsPerPage').value) || 12;
        settings.borderType = document.getElementById('borderType').value;
        settings.paperSize = document.getElementById('paperSize').value;
        
        // Save to localStorage
        localStorage.setItem('priceTagSettings', JSON.stringify(settings));
        
        // Regenerate price tags with new settings if any exist
        if (selectedProducts.length > 0) {
            generatePriceTags();
        }
        
        // Show notification
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    });

    // Load products on page load
    loadProducts();

    // Download price tags as PDF
    downloadPdfButton.addEventListener('click', async function() {
        loading.style.display = 'flex';
        
        setTimeout(async function() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: settings.paperSize
                });
                
                const priceTags = priceTagsContainer.querySelectorAll('.price-tag');
                
                if (priceTags.length === 0) {
                    alert('Tidak ada label price tag untuk diunduh.');
                    loading.style.display = 'none';
                    return;
                }
                
                // Calculate positioning
                const margin = 10; // mm
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                
                const tagsPerRow = Math.floor((pageWidth - 2 * margin) / settings.priceTagWidth);
                const tagsPerCol = Math.floor((pageHeight - 2 * margin) / settings.priceTagHeight);
                const tagsPerPage = tagsPerRow * tagsPerCol;
                
                // Capture each price tag as an image and add to PDF
                let currentPage = 1;
                let tagCounter = 0;
                
                for (let i = 0; i < priceTags.length; i++) {
                    // Calculate position
                    const col = tagCounter % tagsPerRow;
                    const row = Math.floor(tagCounter / tagsPerRow) % tagsPerCol;
                    
                    // Add new page if needed
                    if (tagCounter > 0 && tagCounter % tagsPerPage === 0) {
                        doc.addPage();
                        currentPage++;
                        tagCounter = 0;
                    }
                    
                    const xPos = margin + (col * settings.priceTagWidth);
                    const yPos = margin + (row * settings.priceTagHeight);
                    
                    // Capture price tag as canvas
                    const canvas = await html2canvas(priceTags[i], {
                        scale: 2, // Higher resolution
                        backgroundColor: 'white'
                    });
                    
                    // Add to PDF
                    const imgData = canvas.toDataURL('image/png');
                    doc.addImage(imgData, 'PNG', xPos, yPos, settings.priceTagWidth, settings.priceTagHeight);
                    
                    tagCounter++;
                }
                
                // Save the PDF
                doc.save('price-tags.pdf');
                
                loading.style.display = 'none';
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Terjadi kesalahan saat membuat PDF. Silakan coba lagi.');
                loading.style.display = 'none';
            }
        }, 500); // Small delay to allow loading indicator to appear
    });

    // Batch label generation function
    

    // Export data function
    function exportSelectedProductsData() {
        if (selectedProducts.length === 0) {
            alert('Pilih minimal satu produk untuk diekspor.');
            return;
        }
        
        // Create CSV content
        let csvContent = "data:text/csv;charset=utf-8,";
        
        // Add headers
        csvContent += "Kode Toko,Kode Barang,PLU,Nama Barang,Kategori,Harga Jual,Harga Beli,Stok\n";
        
        // Add data rows
        selectedProducts.forEach(product => {
            const row = [
                product.kodeToko || '',
                product.kode || '',
                product.plu || '',
                product.nama || '',
                product.kategori || '',
                product.hargaJual || 0,
                product.hargaBeli || 0,
                product.stok || 0
            ].join(',');
            
            csvContent += row + "\n";
        });
        
        // Create download link
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "product_data.csv");
        document.body.appendChild(link);
        
        // Trigger download
        link.click();
        
        // Clean up
        document.body.removeChild(link);
    }

    // Add "Batch Print" button to the interface
    const addBatchButtonToInterface = () => {
        const printSection = document.querySelector('.print-section');
        if (printSection) {
            const batchButton = document.createElement('button');
            batchButton.id = 'batchPrintButton';
            batchButton.innerHTML = '<i class="fas fa-copy"></i> Cetak Batch';
            batchButton.addEventListener('click', () => {
                const count = parseInt(prompt('Masukkan jumlah label untuk setiap produk:', '5')) || 0;
                if (count > 0) {
                    generateBatchLabels(count);
                }
            });
            printSection.appendChild(batchButton);
        }
    };

    // Add "Export" button to the interface
    const addExportButtonToInterface = () => {
        const printSection = document.querySelector('.print-section');
        if (printSection) {
            const exportButton = document.createElement('button');
            exportButton.id = 'exportButton';
            exportButton.innerHTML = '<i class="fas fa-file-csv"></i> Export CSV';
            exportButton.addEventListener('click', exportSelectedProductsData);
            printSection.appendChild(exportButton);
        }
    };

    // Call functions to add new buttons
    addBatchButtonToInterface();
    addExportButtonToInterface();

    // Add keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl+P for print
        if (e.ctrlKey && e.key === 'p') {
            e.preventDefault();
            printButton.click();
        }
        
        // Ctrl+S for save settings
        if (e.ctrlKey && e.key === 's' && document.getElementById('settings').classList.contains('active')) {
            e.preventDefault();
            saveSettingsButton.click();
        }
        
        // Ctrl+F for search focus
        if (e.ctrlKey && e.key === 'f' && document.getElementById('browse').classList.contains('active')) {
            e.preventDefault();
            searchInput.focus();
        }

        // Ctrl+B for batch print
        if (e.ctrlKey && e.key === 'b' && document.getElementById('preview').classList.contains('active')) {
            e.preventDefault();
            document.getElementById('batchPrintButton')?.click();
        }

        // Ctrl+E for export
        if (e.ctrlKey && e.key === 'e' && document.getElementById('preview').classList.contains('active')) {
            e.preventDefault();
            document.getElementById('exportButton')?.click();
        }
    });
});
    </script>
</body>
</html>